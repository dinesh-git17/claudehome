# Epic: Tailwind CSS v4.1 CSS-First Architecture

**Epic ID:** E0-UI-01

**Phase:** 0 — Local Ecosystem Scaffolding

**Status:** Ready for Implementation

**Last Updated:** 2026-01-15

---

## Epic Description

This epic transitions the styling architecture to the newly released Tailwind CSS v4.1 engine, leveraging the Rust-based Oxide build chain for extreme performance. It involves provisioning the pipeline via `@tailwindcss/postcss`, implementing the "Contemplative" design system using the native `@theme` directive with strict OKLCH color spaces, and validating the integration of v4.1-exclusive features like native `text-shadow` and `mask` utilities. The configuration is strictly CSS-first, with zero reliance on legacy JavaScript config files, ensuring a future-proof, standards-compliant styling layer.

**Exit Criteria:** A validated Tailwind v4.1 styling pipeline integrated with Turbopack, with the Contemplative design system tokens generating functional utilities and v4.1-specific features verified operational.

---

## Design Document Divergence Notice

> **Note:** `design_doc.md:165` references `tailwind.config.ts` in the planned file structure. This epic **explicitly deviates** from that reference to adopt the superior Tailwind v4 CSS-first architecture. The `@theme` directive in CSS replaces all JavaScript configuration. No `tailwind.config.ts` or `tailwind.config.js` file will be created. This divergence is intentional and represents the concrete execution plan superseding the high-level design document.

---

## Prerequisites

Before starting this epic:

1. **E0-CORE-01 completed** — React Compiler, Turbopack enforcement, and server/client boundary packages are in place
2. **Turbopack Pipeline Stable** — `pnpm --filter @claudehome/web build` succeeds with exit code 0
3. **Node.js 24.11.1** and **pnpm 9.15.0** — As specified in root `package.json`

---

## Governance

### No-AI Attribution Policy

**Enforcement:** Manual review with full artifact scan.

**Reviewers must reject any PR containing:**

- `Co-Authored-By:` headers referencing AI tools (Claude, Copilot, etc.) in commit messages
- "Generated by...", "Created with AI", or similar attributions in PR descriptions
- AI-specific comments, badges, or markers in code comments or file headers
- Robotic or templated language that breaks professional authorship standards

**Policy:** "Invisible Hand" — All code must stand on its own merit, indistinguishable from high-quality human authorship.

### No-Config Policy

**Enforcement:** Build-time validation and code review.

- Zero JavaScript configuration files for Tailwind CSS
- All design tokens defined in CSS via `@theme` directive
- No `tailwind.config.js`, `tailwind.config.ts`, or `tailwind.config.mjs` permitted
- PostCSS configuration limited to plugin registration only

---

## Browser Support Matrix

**Target browsers for OKLCH color support:**

| Browser | Minimum Version | OKLCH Support |
| ------- | --------------- | ------------- |
| Chrome  | 111+            | Native        |
| Firefox | 113+            | Native        |
| Safari  | 15.4+           | Native        |
| Edge    | 111+            | Native        |

**Fallback Strategy:** Tailwind v4's built-in fallback mechanism generates RGB equivalents automatically for older browsers. No manual `@supports` blocks required.

---

## Contemplative Design System Token Reference

The following OKLCH values are authoritative for this epic (sourced from `design_doc.md:365-381`):

```css
/* Background layers */
--color-void: oklch(8% 0.02 260); /* Deepest black */
--color-surface: oklch(12% 0.02 260); /* Card backgrounds */
--color-elevated: oklch(16% 0.02 260); /* Modals, popovers */

/* Text */
--color-text-primary: oklch(92% 0.01 260); /* Main text */
--color-text-secondary: oklch(65% 0.01 260); /* Muted text */
--color-text-tertiary: oklch(45% 0.01 260); /* Disabled/hints */

/* Accents */
--color-accent-warm: oklch(70% 0.15 50); /* Warm amber for active states */
--color-accent-cool: oklch(70% 0.12 250); /* Cool blue for links */
--color-accent-dream: oklch(75% 0.18 320); /* Purple for creative content */
```

---

## Stories

### S-UI-00: Tailwind v4.1 Availability Gate

**Story Points:** 1

**Description:**
Verify that Tailwind CSS v4.1+ is available via npm and that the target v4.1-exclusive features (`text-shadow-*`, `mask-*` utilities) are documented and functional. This gate prevents downstream stories from failing due to version unavailability or undocumented API assumptions.

**Acceptance Criteria:**

| #   | Criterion                                                               | Verification Method                                                                         |
| --- | ----------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| 1   | `npm view tailwindcss version` returns 4.1.0 or higher                  | Terminal command output                                                                     |
| 2   | `@tailwindcss/postcss` package exists and is compatible with v4.1       | `npm view @tailwindcss/postcss` succeeds                                                    |
| 3   | Tailwind v4 documentation confirms `text-shadow-*` utility class naming | Manual review of [tailwindcss.com/docs](https://tailwindcss.com/docs)                       |
| 4   | Tailwind v4 documentation confirms mask utility class naming convention | Manual review; document exact class names (e.g., `mask-type-alpha`, `mask-position-center`) |

**If Gate Fails:**

- If v4.1 is unavailable, install `tailwindcss@^4.0.0` and remove v4.1-specific acceptance criteria from S-UI-04 and S-UI-05
- Document the version installed and any feature limitations
- Proceed with v4.0 stable features only

---

### S-UI-01: v4.1 Engine Installation & Legacy Purge

**Story Points:** 1

**Description:**
Install `tailwindcss@latest` (v4.1+) and `@tailwindcss/postcss` to activate the Rust-based Oxide engine. Aggressively purge any `tailwind.config.js/ts` to enforce the CSS-first architecture. Configure `postcss.config.mjs` strictly for the Tailwind plugin, ensuring compatibility with Next.js 16's Turbopack pipeline.

**Dependencies:**

- S-UI-00 completed (version availability confirmed)

**Acceptance Criteria:**

| #   | Criterion                                                                      | Verification Method                                           |
| --- | ------------------------------------------------------------------------------ | ------------------------------------------------------------- |
| 1   | `tailwindcss` v4.1+ installed in `apps/web`                                    | `pnpm --filter @claudehome/web list tailwindcss` shows ^4.1.0 |
| 2   | `@tailwindcss/postcss` installed in `apps/web`                                 | `pnpm --filter @claudehome/web list @tailwindcss/postcss`     |
| 3   | No `tailwind.config.js`, `tailwind.config.ts`, or `tailwind.config.mjs` exists | `ls apps/web/tailwind.config.*` returns "No such file"        |
| 4   | `postcss.config.mjs` exists and exports `@tailwindcss/postcss` plugin          | Code review of file contents                                  |
| 5   | `pnpm --filter @claudehome/web dev` starts without legacy config warnings      | No "tailwind.config" warnings in terminal output              |
| 6   | Turbopack + PostCSS config coexistence verified                                | `pnpm dev` logs show Turbopack active, no PostCSS conflicts   |

**postcss.config.mjs Reference Implementation:**

```javascript
export default {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};
```

---

### S-UI-02: CSS Entry Point & @theme Architecture

**Story Points:** 2

**Description:**
Architect `src/app/globals.css` using the v4.1 `@import "tailwindcss";` directive. Define the root `@theme` block to replace legacy configuration. Establish the `:root` scope for fallback variables while prioritizing the `@theme` directive for direct token-to-utility mapping.

**Dependencies:**

- S-UI-01 completed

**Acceptance Criteria:**

| #   | Criterion                                                                                       | Verification Method                                       |
| --- | ----------------------------------------------------------------------------------------------- | --------------------------------------------------------- |
| 1   | `src/app/globals.css` exists and starts with `@import "tailwindcss";`                           | Code review                                               |
| 2   | `@theme { ... }` block defined and contains at minimum one custom property                      | Code review                                               |
| 3   | No legacy `@tailwind base;`, `@tailwind components;`, `@tailwind utilities;` directives present | Code review; grep for `@tailwind` returns no matches      |
| 4   | `src/app/layout.tsx` imports `./globals.css`                                                    | Code review of import statement                           |
| 5   | Basic utilities (`flex`, `p-4`, `bg-white`) functional in browser                               | Manual browser test; inspect element shows correct styles |
| 6   | `pnpm build` succeeds without CSS parsing errors                                                | Exit code 0, no `@theme` or `@import` errors in output    |

---

### S-UI-03: OKLCH Design Token Definition

**Story Points:** 3

**Description:**
Implement the "Contemplative" color system within `@theme` using strict OKLCH syntax as defined in the Token Reference section above. Define semantic tokens (e.g., `--color-void`) that map to `oklch(...)` values. Ensure tokens automatically generate Tailwind utilities (e.g., `bg-void`) and leverage v4's color fallback support for browsers in the support matrix.

**Dependencies:**

- S-UI-02 completed

**Acceptance Criteria:**

| #   | Criterion                                                                                | Verification Method                                                                        |
| --- | ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| 1   | All 9 Contemplative palette tokens defined in `@theme` block                             | Code review against Token Reference section                                                |
| 2   | Tokens use `oklch()` function syntax in source CSS                                       | `grep "oklch" src/app/globals.css` returns all 9 tokens                                    |
| 3   | Custom utilities (`bg-void`, `text-text-primary`, `bg-accent-warm`) apply correct colors | Manual browser test; visual inspection matches expected colors                             |
| 4   | CSS custom properties inspectable in DevTools under `:root` or `@theme` scope            | Chrome DevTools → Elements → Computed → filter "color"                                     |
| 5   | Source CSS contains zero hex color codes for the 9 primary tokens                        | `grep -E "#[0-9a-fA-F]{3,6}" src/app/globals.css` returns no matches for token definitions |
| 6   | Build output CSS contains fallback values for older browsers                             | Inspect `.next/static/css/*.css` for RGB equivalents alongside OKLCH                       |

---

### S-UI-04: v4.1 Typography & Visual Effects

**Story Points:** 2

**Description:**
Define the typography system in `@theme` and implement global base styles. Integrate v4.1-specific utilities by validating that the new native `text-shadow-*` class names are available and functional. Apply global resets via `@layer base` referencing the OKLCH tokens.

**Dependencies:**

- S-UI-03 completed

**Acceptance Criteria:**

| #   | Criterion                                                                              | Verification Method                                                                                          |
| --- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| 1   | `--font-sans` and `--font-mono` defined in `@theme`                                    | Code review                                                                                                  |
| 2   | `@layer base` sets `background-color` and `color` on `body` using OKLCH tokens         | Code review; body uses `bg-void text-text-primary` or equivalent                                             |
| 3   | **v4.1 Verification:** `text-shadow-sm` utility applies visible text shadow            | Create test element with class `text-shadow-sm`; DevTools shows `text-shadow` property with non-`none` value |
| 4   | Typography utilities (`font-sans`, `font-mono`) produce correct `font-family`          | DevTools computed styles show expected font stack                                                            |
| 5   | If `text-shadow-*` unavailable in installed version, document limitation and skip AC#3 | Add note to PR description if skipped                                                                        |

---

### S-UI-05: Build Pipeline & Feature Verification

**Story Points:** 3

**Description:**
Validate the production build artifact under Turbopack. Verify that v4.1 exclusive features like mask utilities or `text-shadow-*` are correctly generated and that the CSS bundle is optimized (tree-shaken). Ensure zero runtime CSS-in-JS injection occurs.

**Dependencies:**

- S-UI-04 completed

**Acceptance Criteria:**

| #   | Criterion                                                                                       | Verification Method                                                                 |
| --- | ----------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| 1   | `pnpm --filter @claudehome/web build` passes with Turbopack                                     | Exit code 0; output contains "Turbopack" reference                                  |
| 2   | Output CSS in `.next/static/css/` contains OKLCH variables or their fallbacks                   | `grep "oklch\|--color-" .next/static/css/*.css` returns matches                     |
| 3   | **v4.1 Verification:** Test element with mask utility renders correctly (if available)          | Manual browser test; element shows masking effect. Document exact class used.       |
| 4   | CSS delivery is static: no `<style>` tags dynamically injected by JavaScript after initial HTML | View page source; run app; no new `<style>` tags appear in `<head>` after hydration |
| 5   | `.next/static/css/` total size under 50KB for base styles                                       | `du -sh .next/static/css/` returns <50K                                             |
| 6   | If mask utilities unavailable, document and skip AC#3                                           | Add note to PR description                                                          |

---

## Rollback Procedure

If Tailwind v4.1 proves incompatible with Turbopack or causes build failures:

**Strategy:** Incremental rollback with bisection.

1. **Establish Control State:**
   - Remove `@tailwindcss/postcss` from `postcss.config.mjs`
   - Remove `@import "tailwindcss";` from `globals.css`
   - Uninstall Tailwind packages: `pnpm --filter @claudehome/web remove tailwindcss @tailwindcss/postcss`
   - Verify `pnpm build` succeeds without Tailwind

2. **Bisect — Try v4.0 Stable:**
   - Install `tailwindcss@^4.0.0` (not 4.1)
   - Re-run build; if successful, document v4.1 incompatibility and proceed with v4.0

3. **Fallback — Tailwind v3.x:**
   - If v4.x entirely incompatible with Turbopack:
   - Install `tailwindcss@^3.4.0` with traditional `tailwind.config.ts`
   - Document deviation from CSS-first architecture
   - File upstream issue with Tailwind/Next.js

4. **Document Findings:**
   - Record which version/feature caused instability
   - Create follow-up issue for future migration attempt

---

## Implementation Order

| Order | Story ID | Story Title                             | Points | Dependencies |
| ----- | -------- | --------------------------------------- | ------ | ------------ |
| 0     | S-UI-00  | Tailwind v4.1 Availability Gate         | 1      | None         |
| 1     | S-UI-01  | v4.1 Engine Installation & Legacy Purge | 1      | S-UI-00      |
| 2     | S-UI-02  | CSS Entry Point & @theme Architecture   | 2      | S-UI-01      |
| 3     | S-UI-03  | OKLCH Design Token Definition           | 3      | S-UI-02      |
| 4     | S-UI-04  | v4.1 Typography & Visual Effects        | 2      | S-UI-03      |
| 5     | S-UI-05  | Build Pipeline & Feature Verification   | 3      | S-UI-04      |

**Total Story Points:** 12

---

## Out of Scope

The following are explicitly **not** part of this epic:

- shadcn/ui component installation (separate epic, depends on this epic)
- Dark mode / theme switching logic
- Animation system (Framer Motion integration)
- Typography plugin (`@tailwindcss/typography`)
- Production deployment and CDN optimization
- CI/CD integration for style linting

---

## Definition of Done

- [ ] All six stories completed with acceptance criteria met
- [ ] Tailwind v4.1 (or documented fallback version) integrated with Turbopack
- [ ] Contemplative design system tokens generating functional utilities
- [ ] Zero runtime CSS injection verified
- [ ] CSS bundle under 50KB
- [ ] No `tailwind.config.*` files exist
- [ ] No AI attribution in any commits, PRs, or code artifacts
- [ ] PR approved by reviewer following No-AI policy scan

---

## References

- [Tailwind CSS v4 Documentation](https://tailwindcss.com/docs)
- [Tailwind CSS v4 Announcement](https://tailwindcss.com/blog/tailwindcss-v4)
- [@tailwindcss/postcss Package](https://www.npmjs.com/package/@tailwindcss/postcss)
- [OKLCH Color Space](https://oklch.com/)
- [Next.js PostCSS Configuration](https://nextjs.org/docs/app/building-your-application/styling/postcss)
- [Tailwind CSS v4 Video Overview](https://www.youtube.com/watch?v=9gAASVgrYgo)

---

_This epic supersedes any conflicting guidance in design_doc.md regarding Tailwind configuration approach._
